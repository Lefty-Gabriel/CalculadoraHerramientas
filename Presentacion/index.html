<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Productos</title>
</head>
<body>

    <h1>Ingreso de Productos</h1>

    <input id="nombre" placeholder="Nombre del producto" minlength="3" maxlength="40">
    <input id="precio" type="number" min="0.01" step="0.01" placeholder="Precio">
    <button onclick="guardar()">Guardar</button>

    <p id="error" style="color:red;"></p>

    <h2>Productos guardados</h2>
    <ul id="lista"></ul>

    <script>
        async function guardar() {
            const nombre = document.getElementById('nombre').value;
            const precio = document.getElementById('precio').value;
            const errorBox = document.getElementById('error');

            errorBox.textContent = ""; // limpiar error

            const res = await fetch('/api/productos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nombre, precio })
            });

            if (!res.ok) {
                const err = await res.json();
                errorBox.textContent = err.error;
                return;
            }

            await cargarLista();
        }

        async function cargarLista() {
            const res = await fetch('/api/productos');
            const productos = await res.json();

            const ul = document.getElementById("lista");
            ul.innerHTML = "";

            productos.forEach(p => {
                const li = document.createElement("li");
                li.textContent = `${p.nombre} - Subtotal: ${p.subtotal.toFixed(2)}, IVA: ${p.iva.toFixed(2)}, Total: ${p.total.toFixed(2)}`;
                ul.appendChild(li);
            });
        }

        cargarLista();
    </script>

</body>
</html>
